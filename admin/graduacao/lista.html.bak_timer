<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Graduação (numeração) • Lista</title>

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/admin/css/linkbtn.css">
  <link rel="stylesheet" href="/admin/css/btns.css">

  <style>
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px;color:#e5e7eb}
    .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    table{width:100%;border-collapse:collapse;background:#12151a;border:1px solid #1f2937;border-radius:10px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:left}
    th{color:#93c5fd;font-weight:600;background:#0f141a}
    .actions a{color:#8ecbff;text-decoration:none;margin-right:8px}

    /* Botões padrão (fallback caso /admin/css/*.css não carregue) */
    .btn-back{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.55rem .9rem;background:#111827;border:1px solid #334155;
      border-radius:.6rem;color:#bfdbfe;text-decoration:none;line-height:1
    }
    .btn-back:hover{background:#1e293b}
    .chevron{font-weight:600}

    .btn-primary{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.55rem .9rem;background:#2563eb;border:1px solid #1e40af;
      border-radius:.6rem;color:#eaf2ff;text-decoration:none;line-height:1;
      box-shadow:0 2px 10px rgba(37,99,235,.25)
    }
    .btn-primary:hover{filter:brightness(1.05)}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <!-- UM ÚNICO LINK (sem <a> aninhado) -->
    <a class="btn-back" href="/admin/index.html"><span class="chevron">←</span> Voltar ao Admin</a>

    <!-- UM ÚNICO LINK para adicionar -->
    <a class="btn-primary" href="/admin/graduacao/nova.html">+ Adicionar graduação</a>
  </div>

  <h2 style="color:#9ad1ff">Graduação (numeração) • Lista</h2>

  <table aria-describedby="hint">
    <thead>
    <tr>
      <th>Aluno</th>
      <th>Email</th>
      <th>Nº</th>
      <th>Faixa</th>
      <th>Data</th>
      <th>Ações</th>
    </tr>
    </thead>
    <tbody id="tb">
    <tr><td colspan="6">Carregando…</td></tr>
    </tbody>
  </table>
  <p id="hint" style="opacity:.7;margin:.5rem 0 0">Use “Editar” para ajustar número, faixa ou data.</p>
</div>

<script>
  async function load(){
    const tb = document.getElementById('tb');
    tb.innerHTML = '<tr><td colspan="6">Carregando…</td></tr>';

    try{
      const r  = await fetch('/api/graduacoes');
      const js = await r.json();

      // Aceita tanto {ok:true,data:[...]} quanto um array direto
      const ok   = (js && typeof js === 'object' && 'ok' in js) ? js.ok : Array.isArray(js);
      const data = Array.isArray(js) ? js : (js.data || js.rows || []);

      if(!ok){
        throw new Error((js && js.message) || 'Falha ao carregar');
      }

      if(!Array.isArray(data) || data.length === 0){
        tb.innerHTML = '<tr><td colspan="6">Nenhum registro.</td></tr>';
        return;
      }

      tb.innerHTML = data.map(g => {
        const dataFmt = g.data_graduacao ? new Date(g.data_graduacao).toLocaleDateString('pt-BR') : '';
        return `
            <tr>
              <td>${g.aluno_nome || ''}</td>
              <td>${g.aluno_email || ''}</td>
              <td>${g.grad_numero || ''}</td>
              <td>${g.faixa || ''}</td>
              <td>${dataFmt}</td>
              <td class="actions">
                <a href="/admin/graduacao/editar.html?id=${encodeURIComponent(g.id)}">Editar</a>
              </td>
            </tr>`;
      }).join('');
    }catch(e){
      tb.innerHTML = '<tr><td colspan="6">Falha ao carregar a lista.</td></tr>';
    }
  }

  document.addEventListener('DOMContentLoaded', load);
</script>
</body>
</html>
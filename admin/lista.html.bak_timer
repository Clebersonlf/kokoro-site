
<!-- Script: cancelar convite -->
<script>
  document.getElementById('invCancel')?.addEventListener('click', async () => {
    const inp = document.getElementById('inviteShortLink');
    const token = (inp?.value || '').split('token=')[1];

    if (!token) {
      alert('Nenhum convite para cancelar.');
      return;
    }

    if (!confirm('Tem certeza que deseja cancelar este convite?')) return;

    try {
      const r = await fetch('/api/convites/cancelar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token })
      });
      const j = await r.json().catch(()=> ({}));

      if (!j.ok) throw new Error(j.error || 'Erro ao cancelar convite');

      alert('Convite cancelado com sucesso.');
      document.getElementById('inviteLinkBox').style.display = 'none';
    } catch (e) {
      alert('Falha: ' + e.message);
    }
  });
</script>

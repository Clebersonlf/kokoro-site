<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Aluno • Editar</title>

  <style>
    :root{
      --bg:#0c0f14; --ink:#eaeaea; --line:#1f2530;
      --field-bg:#0f1622; --field-br:#2a3342;
      --btn-bg:#111827; --btn-br:#334155; --btn-hover:#1e293b; --btn-ink:#bfdbfe;
      --muted:#9ca3af;
    }
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial}
    header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid var(--line)}
    main{padding:16px 24px;max-width:780px}

    /* Botão-link padrão (1 link por botão, nada de <a> dentro de <a>) */
    .btn{
      display:inline-flex; align-items:center; gap:.5rem;
      padding:.55rem .9rem; background:var(--btn-bg);
      border:1px solid var(--btn-br); border-radius:.6rem;
      color:var(--btn-ink); text-decoration:none; line-height:1
    }
    .btn:hover{background:var(--btn-hover)}
    .chevron{font-weight:600}

    label{display:block;margin:10px 0 4px}
    input{
      width:100%;padding:10px;border-radius:8px;border:1px solid var(--field-br);
      background:var(--field-bg);color:var(--ink)
    }
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .actions{margin-top:16px;display:flex;gap:10px}
    button{
      padding:10px 14px;border-radius:8px;border:1px solid var(--btn-br);
      background:#1f2937;color:var(--ink);cursor:pointer
    }
    button.danger{border-color:#ef4444;color:#fecaca}
    .hint{color:var(--muted)}
  </style>
</head>
<body>
<header>
  <h1>Aluno • Editar</h1>
  <!-- UM ÚNICO LINK ESTILIZADO COMO BOTÃO -->
  <nav><a class="btn" href="/admin/cadastro/lista.html"><span class="chevron">←</span> Voltar à Lista</a></nav>
</header>

<main>
  <div id="load" class="hint">Carregando...</div>

  <form id="f" style="display:none">
    <input type="hidden" id="id"/>

    <label>Nome</label>
    <input id="nome" required/>

    <div class="row">
      <div>
        <label>Email</label>
        <input id="email" type="email" placeholder="opcional"/>
      </div>
      <div>
        <label>Telefone</label>
        <input id="telefone" placeholder="opcional"/>
      </div>
    </div>

    <label>Nº de Cadastro (não é o de graduação)</label>
    <input id="cad_numero" placeholder="ex: 0012"/>

    <div class="actions">
      <button type="submit">Salvar</button>
      <button type="button" class="danger" id="btnDel">Excluir</button>
    </div>

    <div id="msg" class="hint"></div>
  </form>
</main>

<script>
  function q(name){ return new URLSearchParams(location.search).get(name); }

  async function load(){
    const id = q('id');
    if (!id){ document.getElementById('load').textContent='ID não informado'; return; }

    const r = await fetch('/api/alunos/get?id='+encodeURIComponent(id));
    const j = await r.json();
    if (!j.ok){ document.getElementById('load').textContent=j.message||'Aluno não encontrado'; return; }

    const a = j.aluno;
    f.style.display='block'; loadDiv.style.display='none';
    idEl.value = a.id;
    nome.value = a.nome||'';
    email.value = a.email||'';
    telefone.value = a.telefone||'';
    cad_numero.value = a.cad_numero||'';
  }

  async function salvar(e){
    e.preventDefault();
    msg.textContent='Salvando...';
    const payload = {
      id: idEl.value,
      nome: nome.value.trim(),
      email: email.value.trim().toLowerCase(),
      telefone: telefone.value.trim(),
      cad_numero: cad_numero.value.trim()
    };
    const r = await fetch('/api/alunos/update', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const j = await r.json();
    msg.textContent = j.ok ? 'Salvo!' : (j.message || 'Erro ao salvar');
  }

  async function excluir(){
    if (!confirm('Tem certeza que deseja excluir este aluno?')) return;
    const r = await fetch('/api/alunos/delete', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ id: idEl.value })
    });
    const j = await r.json();
    if (j.ok){ location.href = '/admin/cadastro/lista.html'; }
    else { msg.textContent = j.message || 'Erro ao excluir'; }
  }

  // refs
  const f = document.getElementById('f');
  const idEl = document.getElementById('id');
  const nome = document.getElementById('nome');
  const email = document.getElementById('email');
  const telefone = document.getElementById('telefone');
  const cad_numero = document.getElementById('cad_numero');
  const msg = document.getElementById('msg');
  const loadDiv = document.getElementById('load');
  const btnDel = document.getElementById('btnDel');

  document.addEventListener('DOMContentLoaded', load);
  f.addEventListener('submit', salvar);
  btnDel.addEventListener('click', excluir);
</script>
  <script src="/admin/_session_timer.js" defer></script>
</body>
</html>
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cadastrar • Admin</title>
  <link rel="stylesheet" href="/admin/css/admin-layout.css">
</head>
<body>

  <header class="topbar" style="left:0;">
    <h1>Cadastrar pessoa</h1>
    <div class="actions">
      <a class="btn" href="/admin/">Voltar</a>
      <a class="btn" href="/admin/cadastro/lista.html">Lista</a>
    </div>
  </header>

  <main class="main" style="margin-left:0;">
    <div class="compose" style="max-width:760px;">
      <h2 style="margin:0 0 12px 0;">Novo cadastro</h2>

      <div class="compose-row">
        <label>Nome completo</label>
        <input id="nome" type="text" placeholder="Ex.: João da Silva">
      </div>

      <div class="compose-row">
        <label>E-mail</label>
        <input id="email" type="email" placeholder="Ex.: joao@email.com">
      </div>

      <div class="compose-row">
        <label>Telefone</label>
        <input id="telefone" type="tel" placeholder="Ex.: (31) 99999-9999">
      </div>

      <div class="compose-row">
        <label>Perfil</label>
        <select id="perfil">
          <option value="aluno" selected>Aluno</option>
          <option value="professor">Professor</option>
          <option value="instrutor">Instrutor</option>
        </select>
      </div>

      <div class="compose-actions">
        <button class="btn" id="btn-salvar" type="button">Salvar</button>
        <button class="btn" id="btn-limpar" type="button">Limpar</button>
      </div>

      <p style="margin-top:12px;color:#334155;font-weight:700;">
        Por enquanto é apenas interface. Depois integramos com banco para salvar e classificar por perfil (aluno/professor/instrutor).
      </p>
    </div>
  </main>

  <script>
    // ========== DETECTAR MODO: NOVO OU EDIÇÃO ==========
    const urlParams = new URLSearchParams(window.location.search);
    const alunoId = urlParams.get('id');
    const isEdicao = !!alunoId;

    // Atualizar título
    if (isEdicao) {
      document.querySelector('h2').textContent = 'Editar aluno';
      document.getElementById('btn-salvar').textContent = 'Atualizar';
    }

    // ========== CARREGAR DADOS DO ALUNO (SE EDIÇÃO) ==========
    async function carregarAluno(id) {
      try {
        // TODO: Substituir pela API real quando estiver pronta
        // const response = await fetch(`/api/alunos/${id}`);
        // const aluno = await response.json();
        
        // SIMULAÇÃO (remover depois)
        const aluno = {
          id: id,
          nome: "João da Silva (Exemplo)",
          email: "joao@exemplo.com",
          telefone: "(31) 99999-9999",
          perfil: "aluno"
        };
        
        // Preencher campos
        document.getElementById("nome").value = aluno.nome || "";
        document.getElementById("email").value = aluno.email || "";
        document.getElementById("telefone").value = aluno.telefone || "";
        document.getElementById("perfil").value = aluno.perfil || "aluno";
        
        console.log('Aluno carregado:', aluno);
      } catch (error) {
        console.error('Erro ao carregar aluno:', error);
        alert('Erro ao carregar dados do aluno.');
      }
    }

    // Carregar dados se for edição
    if (isEdicao) {
      carregarAluno(alunoId);
    }

    // ========== SALVAR (INSERT OU UPDATE) ==========
    document.getElementById("btn-salvar").addEventListener("click", async () => {
      const nome = document.getElementById("nome").value.trim();
      const email = document.getElementById("email").value.trim();
      const telefone = document.getElementById("telefone").value.trim();
      const perfil = document.getElementById("perfil").value;

      if (!nome || !email) return alert("Preencha Nome e E-mail.");

      const dados = { nome, email, telefone, perfil };

      if (isEdicao) {
        // UPDATE
        console.log('Atualizando aluno ID:', alunoId, dados);
        alert(`✅ Aluno atualizado (simulado):
${nome} • ${email} • ${perfil}`);
        
        // TODO: Integrar com API
        // await fetch(`/api/alunos/${alunoId}`, {
        //   method: 'PUT',
        //   headers: { 'Content-Type': 'application/json' },
        //   body: JSON.stringify(dados)
        // });
      } else {
        // INSERT
        console.log('Criando novo aluno:', dados);
        alert(`✅ Cadastro criado (simulado):
${nome} • ${email} • ${perfil}`);
        
        // TODO: Integrar com API
        // await fetch('/api/alunos', {
        //   method: 'POST',
        //   headers: { 'Content-Type': 'application/json' },
        //   body: JSON.stringify(dados)
        // });
      }
    });

    // ========== LIMPAR CAMPOS ==========
    document.getElementById("btn-limpar").addEventListener("click", () => {
      document.getElementById("nome").value = "";
      document.getElementById("email").value = "";
      document.getElementById("telefone").value = "";
      document.getElementById("perfil").value = "aluno";
    });
  </script>

</body>
</html>

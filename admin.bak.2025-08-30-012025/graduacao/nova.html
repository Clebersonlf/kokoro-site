<!doctype html><html lang="pt-BR"><head>
<style>.btn-back{display:inline-block;padding:.55rem .9rem;background:#111827;border:1px solid #334155;border-radius:.6rem;color:#bfdbfe;text-decoration:none;line-height:1}.btn-back:hover{background:#1e293b}</style>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Adicionar Graduação</title>
<link rel="stylesheet" href="/css/style.css">
<style>
.wrap{max-width:900px;margin:24px auto;padding:0 16px;color:#e5e7eb}
.top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.top a{color:#8ecbff;text-decoration:none}
.form{background:#151515;border:1px solid #222;border-radius:10px;padding:16px}
label{display:block;margin-top:10px;color:#9ad1ff}
input,select{width:100%;padding:10px;border:1px solid #333;background:#202020;color:#eee;border-radius:8px}
button{padding:10px 14px;border:0;border-radius:8px;cursor:pointer;margin-top:14px}
</style>
<link rel="stylesheet" href="/admin/css/linkbtn.css">

<link rel="stylesheet" href="/admin/css/btns.css">
</head><body>
<div class="wrap">
  <div class="top">
    <a class="btn-back" href="/admin/cadastro/lista.html">← <a class="btn-nav" href="/admin/cadastro/lista.html"><span class="chevron">←</span> Voltar à Lista</a></a>
    <a class="btn-back" href="/admin/index.html">← <a class="btn-nav" href="/admin/index.html"><span class="chevron">←</span> Voltar ao Admin</a></a>
  </div>

  <div class="form">
    <h2 style="color:#9ad1ff">Adicionar Graduação</h2>
    <p>Nº automático é sugerido a partir de <b>0074</b>. Para faixas reservadas (0000–0073), digite manualmente.</p>

    <label>Aluno</label>
    <select id="aluno"></select>

    <label>Nº (opcional)</label>
    <input id="numero" placeholder="deixe em branco para auto (>= 0074)">

    <label>Faixa</label>
    <input id="faixa" list="faixas" placeholder="ex.: Roxa / Marrom / Preta" autocomplete="on">

    <datalist id="faixas">
      <option value="Faixa Branca"></option>
      <option value="Faixa Cinza e Branca"></option>
      <option value="Faixa Cinza"></option>
      <option value="Faixa Cinza e Preta"></option>
      <option value="Faixa Amarela e Branca"></option>
      <option value="Faixa Amarela"></option>
      <option value="Faixa Amarela e Preta"></option>
      <option value="Laranja e Branca"></option>
      <option value="Laranja"></option>
      <option value="Laranja e Preta"></option>
      <option value="Verde e Branca"></option>
      <option value="Verde"></option>
      <option value="Verde e Preta"></option>
      <option value="Faixa Azul"></option>
      <option value="Faixa Roxa"></option>
      <option value="Faixa Marrom"></option>
      <option value="Faixa Preta Lisa (Instrutor)"></option>
      <option value="Faixa Preta (1º Grau) Instrutor"></option>
      <option value="Faixa Preta (2º Grau) Professor"></option>
      <option value="Faixa Preta (3º Grau) Professor"></option>
      <option value="Faixa Preta (4º Grau) Professor"></option>
      <option value="Faixa Preta (5º Grau) Professor"></option>
      <option value="Faixa Preta (6º Grau) Professor"></option>
      <option value="Faixa Vermelha e Preta (7º Grau) Mestre"></option>
      <option value="Faixa Vermelha e Branca (8º Grau) Grande Mestre"></option>
      <option value="Faixa Vermelha (9º Grau) Grão Mestre"></option>
      <option value="Faixa Vermelha (10º Grau) Venerável Mestre"></option>
    </datalist>

    <label>Data</label>
    <input id="data" type="date">

    <button onclick="salvar()">Salvar</button>
  </div>
</div>

<script>
async function carregarAlunos(){
  const sel = document.getElementById('aluno');
  sel.innerHTML = '<option>Carregando…</option>';
  const r = await fetch('/api/alunos');
  const js = await r.json();
  sel.innerHTML = (js.ok ? js.data : []).map(a=>`<option value="${a.id}">${a.nome} (${a.email})</option>`).join('') || '<option value="">(sem alunos)</option>';
}

async function salvar(){
  const aluno_id = document.getElementById('aluno').value;
  const numero   = (document.getElementById('numero').value || '').trim();
  const faixa    = (document.getElementById('faixa').value || '').trim();
  const data     = document.getElementById('data').value || null;

  if(!aluno_id){ alert('Selecione um aluno'); return; }

  const r = await fetch('/api/graduacoes', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ aluno_id, grad_numero: numero || undefined, faixa, data_graduacao: data || undefined }),
  });
  const js = await r.json();
  if(!js.ok){ alert(js.message || 'Falha ao salvar'); return; }
  window.location.href = '/admin/graduacao/lista.html';
}

document.addEventListener('DOMContentLoaded', ()=>{
  const d = new Date();
  document.getElementById('data').value = d.toISOString().slice(0,10);
  carregarAlunos();
});
</script>
</body></html>

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alunos • Lista</title>
  <style>
    body{margin:0;background:#0c0f14;color:#eaeaea;font-family:system-ui,Segoe UI,Roboto,Arial}
    header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #1f2530}
    main{padding:16px 24px}
    table{width:100%;border-collapse:collapse;background:#111827;border:1px solid #1f2530;border-radius:12px;overflow:hidden}
    th,td{padding:12px 10px;border-bottom:1px solid #1f2530;font-size:14px}
    th{color:#9ad1ff;text-align:left;background:#0f141b}
    tr:last-child td{border-bottom:0}
    a.btn{color:#60a5fa;text-decoration:none}
    .muted{opacity:.7}
    .btn-back{display:inline-block;padding:.55rem .9rem;background:#111827;border:1px solid #334155;border-radius:.6rem;color:#bfdbfe;text-decoration:none;line-height:1}
  </style>
</head>
<body>
<header>
  <h1>Alunos • Lista</h1>
  <a href="/admin/index.html" class="btn-back">← Voltar ao Admin</a>
</header>

<main>
  <table aria-describedby="tableHint">
    <thead>
    <tr>
      <th>Nome</th>
      <th>Email</th>
      <th>Telefone</th>
      <th>Nº Cadastro</th>
      <th>Criado</th>
      <th></th>
    </tr>
    </thead>
    <tbody id="tb">
    <tr><td class="muted" colspan="6">Carregando…</td></tr>
    </tbody>
  </table>
  <p id="tableHint" class="muted" style="margin:.6rem 0 0">Use “Editar” para alterar um cadastro.</p>
</main>

<script>
  function fmtData(v){
    if(!v) return '';
    const d = new Date(v);
    return isNaN(d) ? '' : d.toLocaleString();
  }

  async function load(){
    const tb = document.getElementById('tb');
    try{
      const r = await fetch('/api/alunos/list');
      const j = await r.json().catch(()=> ({}));
      const rows = j.data || j.rows || [];

      if(!Array.isArray(rows) || rows.length === 0){
        tb.innerHTML = '<tr><td class="muted" colspan="6">Nenhum aluno encontrado.</td></tr>';
        return;
      }

      tb.innerHTML = '';
      rows.forEach(a=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${a.nome ?? ''}</td>
            <td>${a.email ?? ''}</td>
            <td>${a.telefone ?? ''}</td>
            <td><code>${a.cad_numero ?? ''}</code></td>
            <td>${fmtData(a.created_at)}</td>
            <td><a class="btn" href="/admin/cadastro/editar.html?id=${encodeURIComponent(a.id)}">Editar</a></td>
          `;
        tb.appendChild(tr);
      });
    }catch(e){
      tb.innerHTML = '<tr><td class="muted" colspan="6">Falha ao carregar a lista.</td></tr>';
    }
  }

  document.addEventListener('DOMContentLoaded', load);
</script>
</body>
</html>